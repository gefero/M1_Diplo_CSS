

---
## Ejemplo

Importamos una base de datos (ubicada en la carpeta `data` de la clase):
```{r}

```

--
<br>

Usamos la función `colnames()` para ver qué variables (columnas) contiene el objeto llamado `base`:
```{r}
colnames(base)
```

---

<br><br>
<br><br>

Supongamos que queremos trabajar sólo con las siguientes variables, según el diseño de registro de la EPH:

- `ANO4` --> _Año en el que se hizo la encuesta_

- `TRIMESTRE` --> _Trimestre en el que hizo la encuesta_

- `ESTADO` --> _Condición de actividad de la persona entrevistada (Ocupado / Desocupado / Inactivo)_

- `CAT_OCUP` --> _Categoría ocupacional de la persona entrevistada (Asalariado / Cuentrapropista / Patrón)_

---

```{r sel, eval = F, echo = F}
base %>%
  select(ANO4, TRIMESTRE, ESTADO, CAT_OCUP)
```

`r apply_reveal("sel")`

---
class: middle, center

## Otra forma de selecionar

---

```{r sel2, eval = F, echo = F}
base %>%
  select(2:6)
```

`r apply_reveal("sel2")`

---
class: middle, center

## Una más!

---

```{r sel3, eval = F, echo = F}
base %>%
  select(ANO4:AGLOMERADO)
```

`r apply_reveal("sel3")`

---
class: middle, center

## En la selección, también damos el orden de las columnas

---

```{r sel4, eval = F, echo = F}
base %>%
  select(CAT_OCUP, ESTADO, TRIMESTRE, ANO4)
```

`r apply_reveal("sel4")`

---
class: center, middle

# __PRÁCTICA__

---

class: middle, center

# __filter()__

***

#### _Filtra casos (filas) de una base de datos en función de una o más variables_

---
<br><br>
<br><br>

- En R base: 
```r
base_de_dato$variable[base_de_datos$variable == categoria]
```

--
<br>

- En `tidyverse`:
```r
base_de_datos %>% 
  filter(variable == categoria)
```

---
<br><br>
<br><br>

Supongamos que queremos quedarnos con la población que reside en `Bahía Blanca`:
 
Según el diseño de registro de la EPH, la variable se llama `AGLOMERADO` y el valor que corresponde a Bahía Blanca es el `3`. 

La sentencia quedaría de la siguiente manera:

---
```{r fil1, eval = F, echo = F}
base %>%
  select(TRIMESTRE, ANO4, AGLOMERADO) %>% 
  filter(AGLOMERADO == 3)
```

`r apply_reveal("fil1")`

---

<br><br>
<br><br>

#### Condiciones por las cuales filtrar:

.pull-left[

|Condición |Acción              |
| :---     | ---:               |
|          |                    |
| `==`     | *igual*            |
| `!=`     | *distinto*         |
| `>`      | *mayor que*        |
| `<`      | *menor que*        |
| `>=`     | *mayor o igual que*|
| `<=`     | *menor o igual que*|

]

.pull-right[

| Operador | Descripción |
| :---     | ---:               |
|          |                    |
| `&`      | *y* - Cuando se cumplen ambas condiciones   |
| &#124;   | *o* - Cuando se cumple una u otra condición   |


]

---
class: middle, 

Supongamos que queremos quedarnos sólo con aquella población que cumpla las siguientes condiciones:

- Se encuentre ocupada (`ESTADO == 1`);

- Viva en _La Plata_ (`AGLOMERADO == 2`) o en Santa Fé (`AGLOMERADO == 5`);

- Sea asalariada (`CAT_OCUP == 3`):

---
```{r fil2, rows.print=10, col.print=10, eval = F, echo = F}
base %>%
  select(TRIMESTRE, ANO4, AGLOMERADO, ESTADO, CAT_OCUP) %>% 
  filter(ESTADO == 1 & CAT_OCUP == 3) %>% 
  filter(AGLOMERADO == 2 | AGLOMERADO == 5)
```

`r apply_reveal("fil2")`

---
class: center, middle

# __PRÁCTICA__

---
class: middle, center

# __mutate()__

***

#### _Crea variables nuevas o reemplaza existentes_

---

<br><br>
<br><br>

- En R base: 
```r
base_de_dato$var_nueva <- base_de_datos$var_1 + base_de_datos$var_2
```
--
<br>

- En `tidyverse`:
```r
base_de_datos %>% 
   mutate(var_nueva = var_1 + var_2)
```

---
class: center, middle

Caso: Necesito crear la variable __año__. Para ello necesito extraer los primeros 4 dígitos de la variable __Mes__, que presenta sus datos 

---
```{r mut1, rows.print=10, col.print=10, eval = F, echo = F}
base %>%
  select(ESTADO, CAT_OCUP, P21, TOT_P12) %>% 
  filter(ESTADO == 1) %>% 
  filter(P21 > 0 & TOT_P12 > 0) %>% 
  mutate(ingreso_tot = P21 + TOT_P12)
```

`r apply_reveal("mut1")`

---
class: center, middle

## Con `mutate()` también se puede editar una variable ya existente en la base de datos

---
```{r mut2, rows.print=10, col.print=10, eval = F, echo = F}
base %>%
  select(ESTADO, CAT_OCUP, P21, TOT_P12) %>% 
  filter(ESTADO == 1) %>% 
  mutate(ESTADO = case_when(ESTADO == 1 ~ "Ocupado/a",
                            ESTADO == 2 ~ "Desocupado/a",
                            ESTADO == 3 ~ "Inactivo/a",
                            ESTADO == 4 ~ "Menor de 10 años"))
```

`r apply_reveal("mut2")`

---
class: center, middle

# __PRÁCTICA__

---

class: middle, center

# __rename()__

***

#### _Asigna un nuevo nombre a variables existentes_

---

<br><br>
<br><br>

- En R base: 

```r
colnames(base_de_datos)[1] <- "nombre_nuevo"
```

<br> 

- En `tidyverse`:
```r
base_de_datos %>% 
   rename(var_nueva = var_vieja)
```

---
class: center, middle

```{r ren1, eval = F, echo = F}
base %>%
  select(ESTADO, CAT_OCUP, P21, TOT_P12) %>% 
  rename(cond_act = ESTADO) %>% 
  rename(categoria_ocupacional = CAT_OCUP,
         ingreso_oc_pr = P21,
         ingreso_otras_oc = TOT_P12)
```

`r apply_reveal("ren1")`

---
class: center, middle

# __PRÁCTICA__

---
class: middle, center

# __arrange()__

***

#### _Ordena los valores de una variable en base a un criterio_

---

<br><br>
<br><br>

Orden ascendente (por default)

```r
base_de_datos %>% 
   arrange(var1)
```
<br>

Orden descentende
```r
base_de_datos %>% 
   arrange(-var1)
```

---

```{r orden1, eval = F, echo = F}
base %>%
  select(ESTADO, CAT_OCUP, P21, TOT_P12) %>% 
  filter(P21 > 0) %>% 
  arrange(P21) %>% 
  arrange(-P21)
```

`r apply_reveal("orden1")`

---
class: center, middle

# __PRÁCTICA__

---
class: middle, center

# __summarise()__

***

#### _Resume la información en una nueva tabla_

---

<br><br>
<br><br>

```r
base_de_datos %>% 
        summarise(var1_resumen = sum(var1),
                  var2_media   = mean(var2),
                  var2_desvio  = sd(var2),
                  var2_cv      = var2_desvio / var2_media * 100)
```

---
```{r summarise1, eval = F, echo = F}
base %>%
  select(ESTADO, CAT_OCUP, CH04, P21) %>% 
  filter(P21 > 0) %>% 
  summarise(ingreso_medio  = mean(P21),
            ingreso_desvio = sd(P21),
            ingreso_cv     = ingreso_desvio / ingreso_medio * 100)
```

`r apply_reveal("summarise1")`


---
class: center, middle

# __PRÁCTICA__

---
class: middle, center

# __group_by()__

***

#### _Aplica una operación sobre la población de forma segmentada por alguna variable_

---

<br><br>
<br><br>

```r
base_de_datos %>% 
        group_by(var1)
```

---
class: center, middle

Queremos conocer el ingreso promedio de la población ocupada según su categoría ocupacional (si son asalariados, patrones o cuentapropistas)

---
```{r group1, eval = F, echo = F}
base %>%
  select(ESTADO, CAT_OCUP, CH04, P21) %>% 
  filter(ESTADO == 1 & P21 > 0) %>% 
  mutate(CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                              CAT_OCUP == 2 ~ "Cuenta propia",
                              CAT_OCUP == 3 ~ "Asalariado")) %>% 
  group_by(CAT_OCUP) %>% 
  summarise(ingreso_medio  = mean(P21),
            ingreso_desvio = sd(P21),
            ingreso_cv     = ingreso_desvio / ingreso_medio * 100)
```

`r apply_reveal("group1")`

---
```{r group2, eval = F, echo = F}
base %>%
  select(ESTADO, CAT_OCUP, CH04, P21) %>% 
  filter(ESTADO == 1 & P21 > 0) %>% 
  mutate(CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                              CAT_OCUP == 2 ~ "Cuenta propia",
                              CAT_OCUP == 3 ~ "Asalariado"),
         CH04     = case_when(CH04 == 1 ~ "Varón",
                              CH04 == 2 ~ "Mujer")) %>%
  group_by(CAT_OCUP, CH04) %>% 
  summarise(ingreso_medio  = mean(P21),
            ingreso_desvio = sd(P21),
            ingreso_cv     = ingreso_desvio / ingreso_medio * 100)
```

`r apply_reveal("group2")`

---
class: middle, center, inverse
  
```{r echo=FALSE, out.width = '50%', fig.align = 'center'}
knitr::include_graphics("img/logo tidyr.png")
```

---
class: center, middle

# __PRÁCTICA__

---
## Funciones del paquete tidyr:

<br>

| __Función__      | __Acción__ |
| :---             | ---:       |
| `pivot_longer()` | *Apila en una columna los valores de varias*|
| `pivot_wider()`   | *Separa en varias columnas los valores de una sola*|


---
class: middle, center

# __pivot_longer()__
***
#### _Reestructura la base, apilando en una columna a varias de ellas y con sus respectivos valores_


---

```{r pivot_l, eval = F, echo = F}
base %>%
  select(ESTADO, CAT_OCUP, CH04, P21) %>% 
  filter(ESTADO == 1 & P21 > 0) %>% 
  mutate(CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                              CAT_OCUP == 2 ~ "Cuenta propia",
                              CAT_OCUP == 3 ~ "Asalariado"),
         CH04     = case_when(CH04 == 1 ~ "Varón",
                              CH04 == 2 ~ "Mujer")) %>%
  group_by(CAT_OCUP, CH04) %>% 
  summarise(ingreso_medio  = mean(P21),
            ingreso_desvio = sd(P21),
            ingreso_cv     = ingreso_desvio / ingreso_medio * 100) %>% 
  pivot_longer(cols = c("ingreso_medio", "ingreso_desvio", "ingreso_cv"), 
               names_to = "Indicador", values_to = "Valor")


```

`r apply_reveal("pivot_l")`

---
class: middle, center

# __pivot_wider()__
***
#### _Reestructura la base, apilando en varias columnas a una de ellas por cada categoría de la misma_

---

```{r pivot_2, eval = F, echo = F}
base %>%
  select(ESTADO, CAT_OCUP, CH04, P21) %>% 
  filter(ESTADO == 1 & P21 > 0) %>% 
  mutate(CAT_OCUP = case_when(CAT_OCUP == 1 ~ "Patrón",
                              CAT_OCUP == 2 ~ "Cuenta propia",
                              CAT_OCUP == 3 ~ "Asalariado"),
         CH04     = case_when(CH04 == 1 ~ "Varón",
                              CH04 == 2 ~ "Mujer")) %>%
  group_by(CAT_OCUP, CH04) %>% 
  summarise(ingreso_medio  = mean(P21),
            ingreso_desvio = sd(P21),
            ingreso_cv     = ingreso_desvio / ingreso_medio * 100) %>% 
  pivot_longer(cols = c("ingreso_medio", "ingreso_desvio", "ingreso_cv"), 
               names_to = "Indicador", values_to = "Valor") %>% 
  pivot_wider(names_from = "Indicador", values_from = "Valor")
```

`r apply_reveal("pivot_2")`

---

class: center, middle

# __¡Manos a la obra!__

```{css, eval = TRUE, echo = F}
.remark-code{line-weight: 8; font-size: 75%}
```